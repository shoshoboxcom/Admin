<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Äî MM2 Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --border: #1e1e2e;
    --accent: #9403fc;
    --accent2: #ff3c78;
    --text: #e8e8f0;
    --muted: #555570;
    --green: #00e87a;
    --red: #ff3c78;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: 'Space Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 14px;
  }

  /* ===== LOGIN ===== */
  #login-screen {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 16px;
  }

  .login-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 36px 24px;
    width: 100%;
    max-width: 360px;
    text-align: center;
  }

  .login-logo {
    font-family: 'Syne', sans-serif;
    font-size: clamp(22px, 6vw, 28px);
    font-weight: 800;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 6px;
  }

  .login-sub { color: var(--muted); font-size: 11px; margin-bottom: 28px; letter-spacing: 2px; }

  .login-input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 16px;
    margin-bottom: 14px;
    outline: none;
    transition: border-color 0.2s;
    text-align: center;
    letter-spacing: 3px;
  }

  .login-input:focus { border-color: var(--accent); }

  .login-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 10px;
    padding: 15px;
    color: #fff;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 2px;
    cursor: pointer;
    transition: opacity 0.2s;
    touch-action: manipulation;
  }

  .login-btn:active { opacity: 0.8; }
  .login-error { color: var(--red); font-size: 12px; margin-top: 10px; display: none; }

  /* ===== MAIN ===== */
  #main-panel { display: none; }

  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    position: sticky;
    top: 0;
    z-index: 100;
    gap: 10px;
  }

  .header-left {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: clamp(15px, 4vw, 20px);
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    white-space: nowrap;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
  }

  .save-btn {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 8px;
    padding: 10px 16px;
    color: #fff;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 1px;
    cursor: pointer;
    transition: opacity 0.2s;
    touch-action: manipulation;
    white-space: nowrap;
  }

  .save-btn:active { opacity: 0.8; }
  .save-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .logout-btn {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
    touch-action: manipulation;
    white-space: nowrap;
  }

  .logout-btn:active { border-color: var(--red); color: var(--red); }

  /* STATUS */
  .status-bar {
    padding: 0 16px;
    min-height: 0;
    overflow: hidden;
    transition: min-height 0.2s;
  }

  .status-msg {
    font-size: 12px;
    padding: 10px 14px;
    border-radius: 8px;
    display: none;
    margin: 10px 0 0;
    text-align: center;
  }

  .status-msg.success { background: rgba(0,232,122,0.1); color: var(--green); border: 1px solid rgba(0,232,122,0.2); }
  .status-msg.error   { background: rgba(255,60,120,0.1); color: var(--red);   border: 1px solid rgba(255,60,120,0.2); }
  .status-msg.loading { background: rgba(148,3,252,0.1);  color: var(--accent); border: 1px solid rgba(148,3,252,0.2); }
  .status-msg.show    { display: block; }

  /* ===== CONTAINER ===== */
  .container { padding: 16px; max-width: 900px; margin: 0 auto; }

  /* ===== STATS ===== */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 8px;
    text-align: center;
  }

  .stat-num {
    font-family: 'Syne', sans-serif;
    font-size: clamp(22px, 6vw, 32px);
    font-weight: 800;
    line-height: 1;
    margin-bottom: 4px;
  }

  .stat-num.green  { color: var(--green); }
  .stat-num.red    { color: var(--red); }
  .stat-num.purple {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .stat-label { color: var(--muted); font-size: 9px; letter-spacing: 1.5px; }

  /* ===== TOOLBAR ===== */
  .toolbar {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 16px;
  }

  .toolbar-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .search-box {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 14px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 16px;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-box:focus { border-color: var(--accent); }

  .filter-btn {
    flex: 1;
    min-width: 0;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 6px;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    text-align: center;
    touch-action: manipulation;
  }

  .filter-btn.active { border-color: var(--accent); color: var(--accent); }
  .filter-btn:active { border-color: var(--accent); color: var(--accent); }

  .bulk-btn {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 6px;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    text-align: center;
    touch-action: manipulation;
  }

  .bulk-btn.green-btn:active { border-color: var(--green); color: var(--green); }
  .bulk-btn.red-btn:active   { border-color: var(--red);   color: var(--red); }

  /* ===== PRODUCT GRID ===== */
  .product-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  @media (min-width: 640px) {
    .product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 900px) {
    .product-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .product-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    transition: border-color 0.2s;
  }

  .product-card.out { opacity: 0.55; }

  .product-card-top {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .product-img {
    width: 56px;
    height: 56px;
    border-radius: 10px;
    object-fit: cover;
    flex-shrink: 0;
    background: var(--bg);
  }

  .product-info { flex: 1; min-width: 0; }

  .product-name-txt {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 5px;
  }

  .product-meta { display: flex; gap: 5px; align-items: center; flex-wrap: wrap; }

  .badge { font-size: 9px; padding: 2px 7px; border-radius: 4px; font-weight: 700; letter-spacing: 1px; }
  .badge-rarity-godly    { background: rgba(255,0,0,0.15);    color: #ff5555; }
  .badge-rarity-ancient  { background: rgba(98,0,255,0.15);   color: #9b6bff; }
  .badge-rarity-unique   { background: rgba(255,140,0,0.15);  color: #ffb347; }
  .badge-rarity-legendary{ background: rgba(255,0,0,0.1);     color: #ff6666; }
  .badge-rarity-rare     { background: rgba(38,192,0,0.15);   color: #5dde5d; }
  .badge-rarity-uncommon { background: rgba(0,145,255,0.15);  color: #5ab4ff; }
  .badge-rarity-common   { background: rgba(128,128,128,0.15);color: #aaa; }
  .badge-rarity-vintage  { background: rgba(255,204,0,0.15);  color: #ffd740; }
  .badge-cat    { background: rgba(148,3,252,0.15); color: #c060ff; }
  .badge-chroma { background: rgba(255,60,120,0.15); color: var(--accent2); }
  .badge-disc   { background: rgba(255,215,0,0.15); color: #ffd740; border: 1px solid rgba(255,215,0,0.3); }

  /* ===== TOGGLE ===== */
  .toggle-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
  }

  .toggle { position: relative; width: 52px; height: 28px; cursor: pointer; touch-action: manipulation; }
  .toggle input { opacity: 0; width: 0; height: 0; }

  .slider { position: absolute; inset: 0; background: var(--border); border-radius: 28px; transition: 0.25s; }
  .slider::before {
    content: '';
    position: absolute;
    width: 20px; height: 20px;
    left: 4px; bottom: 4px;
    background: var(--muted);
    border-radius: 50%;
    transition: 0.25s;
  }

  input:checked + .slider { background: rgba(0,232,122,0.25); border: 1px solid var(--green); }
  input:checked + .slider::before { transform: translateX(24px); background: var(--green); }

  .toggle-label { font-size: 9px; letter-spacing: 1px; font-weight: 700; }
  .toggle-label.in  { color: var(--green); }
  .toggle-label.out { color: var(--red); }

  /* ===== PRICE EDITOR ===== */
  .price-editor {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .price-fields {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .price-field label {
    display: block;
    font-size: 9px;
    color: var(--muted);
    letter-spacing: 1.5px;
    margin-bottom: 5px;
  }

  .price-input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 10px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 16px;
    outline: none;
    transition: border-color 0.2s;
  }

  .price-input:focus { border-color: var(--accent); }

  .price-preview {
    background: rgba(148,3,252,0.05);
    border: 1px solid rgba(148,3,252,0.15);
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 11px;
    color: var(--muted);
    line-height: 1.7;
  }

  .price-preview .pv  { color: var(--green); font-weight: 700; font-size: 13px; }
  .price-preview .po  { color: var(--red); text-decoration: line-through; }
  .price-preview .pd  { color: #ffd740; font-weight: 700; }
  .price-preview .dim { color: #444; font-size: 10px; }

  /* ===== POPULAR BTN ===== */
  .popular-btn {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 12px;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    touch-action: manipulation;
  }

  .popular-btn:active { opacity: 0.8; }

  .popular-btn.popular-on {
    background: rgba(255,215,0,0.08);
    border-color: rgba(255,215,0,0.4);
    color: #ffd740;
  }

  /* ===== EMPTY ===== */
  .empty-state {
    text-align: center;
    padding: 48px 16px;
    color: var(--muted);
    font-size: 13px;
  }

  .empty-state div:first-child { font-size: 32px; margin-bottom: 12px; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">MM2 SHOP</div>
    <div class="login-sub">ADMIN PANEL</div>
    <input type="password" class="login-input" id="password-input"
      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
      onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">–í–û–ô–¢–ò</button>
    <div class="login-error" id="login-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
  </div>
</div>

<!-- MAIN PANEL -->
<div id="main-panel">

  <header>
    <div class="header-left">‚ö° MM2 ADMIN</div>
    <div class="header-right">
      <button class="save-btn" onclick="saveToJsonBin()" id="save-btn">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
      <button class="logout-btn" onclick="doLogout()">–í–´–ô–¢–ò</button>
    </div>
  </header>

  <div class="status-bar">
    <div class="status-msg" id="status-msg"></div>
  </div>

  <div class="container">

    <!-- STATS -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-num purple" id="stat-total">0</div>
        <div class="stat-label">–í–°–ï–ì–û</div>
      </div>
      <div class="stat-card">
        <div class="stat-num green" id="stat-in">0</div>
        <div class="stat-label">–í –ù–ê–õ–ò–ß–ò–ò</div>
      </div>
      <div class="stat-card">
        <div class="stat-num red" id="stat-out">0</div>
        <div class="stat-label">–ù–ï–¢</div>
      </div>
    </div>

    <!-- TOOLBAR -->
    <div class="toolbar">
      <input class="search-box" id="admin-search" placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞..." oninput="renderProducts()">
      <div class="toolbar-row">
        <button class="filter-btn active" id="filter-all" onclick="setFilter('all')">–í–°–ï</button>
        <button class="filter-btn" id="filter-in"  onclick="setFilter('in')">–í –ù–ê–õ–ò–ß–ò–ò</button>
        <button class="filter-btn" id="filter-out" onclick="setFilter('out')">–ù–ï–¢</button>
      </div>
      <div class="toolbar-row">
        <button class="bulk-btn green-btn" onclick="bulkSet(true)">‚úÖ –í–°–ï –í –ù–ê–õ–ò–ß–ò–ò</button>
        <button class="bulk-btn red-btn"   onclick="bulkSet(false)">‚ùå –í–°–ï–• –£–ë–†–ê–¢–¨</button>
      </div>
    </div>

    <!-- GRID -->
    <div class="product-grid" id="admin-product-grid"></div>

  </div>
</div>

<script>
// ========= –ü–ê–†–û–õ–¨ =========
const ADMIN_PASSWORD = 'admin123';

// ========= JSONBIN =========
const JSONBIN_API_KEY = '$2a$10$aeI1awKXrn8g94Y10v5BUeP.zPPFcLoyrt0AgEuCTDBe7XBqSo.ne';
const JSONBIN_BIN_ID  = '6996ee4dd0ea881f40c692c7';

// ========= –¢–û–í–ê–†–´ =========
const PRODUCTS = [
  {
    id: 'sweet',
    name: 'Sweet',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://bit.ly/4aGGm5I',
    price: 1204,
  },
  {
    id: 'treat',
    name: 'Treat',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://bit.ly/4rX6m3H',
    price: 1204,
  },
  {
    id: 'amerilaser',
    name: 'Amerilaser',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEi7lClNZaNx7x9mYBar6jwtp_MLQGvDscIJDeg7-ZpHTdXVJvdLTY6vNVpLkgD_pSKr9VfFUxYAitCP_GiODD37M1yPAb_BTD7kfKlaKbTx2S_drNHsA8v0ljuzbzESiWG7gYCy6U7wDItI8SLceO4Q-WG9Fl5V441auaHmU7E4hp5CgknZMKSr_pxEIPk',
    price: 30,
  },
  {
    id: 'america',
    name: 'America',
    category: 'gun',
    rarity: 'vintage',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEhrr3Bo_afrm8HbHXfXMEIclmRPNCa4X6MoTKoKqevwQFqajs06zWbxlBbOYq841FS9U-mL_rfnfAlMpeufjh6A9yaq38jzdS3VBN9CwWTZ-ASHpYpC5PMzxR_xPE-tewtF2L0GZFia7r5pkD5tTj-Twc2x1cXl9JQCmT_m1_VXqMwWV_jEoWPgvt8loss',
    price: 8,
  },
  {
    id: 'australis',
    name: 'Australis',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/2024Australis.png',
    price: 110,
  },
  {
    id: 'battleaxe',
    name: 'BattleAxe',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEi-IiYtaxU5KhxIkvrUqjE9fOv7dct0oZbFTg0GvqUAM16eKkFmXmmNDOi8Juez16hVfK7oOs03e5UAcu3SO7gWB37Oj0NBOeYo-H6_6jbjkE62c1zSvOQPZsBe1cCHCmNTQsEr6e2L3-xqdjKuffJALrG9EHDxfzzVg8UTuq0FvJXp5e_U2bb62tdYzG8',
    price: 15,
  },
  {
    id: 'battleaxe2',
    name: 'Battle Axe 2',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEj6DRx6DC6hM3zdb7LG31zcm3yK0Ox5W20CisDQPsI2GFICWaWhyjsUzgXLmJjfIRDZE_f8QurvWdUWjpj5JW9SPoJn7Icx6mSMvbSD4pjmKrDZ5Tmi9DC6j_Lh5a2ZwEEtC1RiU2zkk260nsW2I4hoORl62QAp-6HqDg6Cu0APv_RMA-TTrwWlp690rVU',
    price: 20,
  },
  {
    id: 'bauble',
    name: 'Bauble',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Bauble.png',
    price: 885,
  },
  {
    id: 'bat',
    name: 'Bat',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'http://bit.ly/3H4ppXO',
    price: 350,
  },
  {
    id: 'bats-knife',
    name: 'Bats Knife',
    category: 'knife',
    rarity: 'common',
    weaponType: '',
    image: 'https://www.mm2values.com/img/BatsK2018UP.png',
    price: 105,
  },
  {
    id: 'batwing',
    name: 'Batwing',
    category: 'knife',
    rarity: 'ancient',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEiv6L5E1OsunLz5qPS4mRZR9eUcX5NlVroTgO79sc--P8fYShUGOsFqceueCK9Ab3-9RoDn6eHntP6W_XjgvwiY3jNGMuSL3BQYrkkbJ2P-ZNcJm1WeKtkfAfKniTnLnAAcLw6T4MNki_fPDwaOqPmAqWHI5-QkZVZRpRTwCbTOSmVHOqtSGZPFLOyYlAE',
    price: 65,
  },
  {
    id: 'beach',
    name: 'Beach',
    category: 'knife',
    rarity: 'legendary',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Beach_knife.png',
    price: 15,
  },
  {
    id: 'bioblade',
    name: 'BioBlade',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEi1uPY7R5AzXoAADKevlkfcGp0ttNFN6b2kkmGSRQ6LFihrc05k5oIan1uMcm-v6BDl97meuIDWjo06093meTjGaxFa7UEFCpycrRiKfpBEq9UeEhWHbyXAEqbYKfHrr-e_H-PnoTHxkleEd-CsN2KVv4c-otieZUMNcJ5zmlmfVXrdAEO5q-aiQCeVImk',
    price: 15,
  },
  {
    id: 'blaster',
    name: 'Blaster',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEjeq756euToadH-tzGI0r6NCRZchC7e3TUslWYSNjkxD-S0BFgAqIWHFogMXlVbtfz15DXsJPm_HXhiaTAbxnlIcrC1YYcKV2Wjf_aImRccBeYZif6ehW40cEkq78DBtsEuNbiMQp-ikK8lGH5GVbFx9yxTm0Y0xF39DtMwVKgWwiz6DPlLG25NeAGM9LQ',
    price: 25,
  },
  {
    id: 'bloom',
    name: 'Bloom',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Bloom_Knife.png',
    price: 225,
  },
  {
    id: 'blue-seer',
    name: 'Blue Seer',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEhznCd4kbdO6sLW2_MaJrTe5-v7-7Bdgw-ugykP20Zsd92dxu_d0TPtQrH8uOREwJ19t6StXQlMrPEQpEp0WfjmE6aQRSbeLOVb6JTEruej49SS1IrmwuEMRprwV8VRxS6n6DqQYZi17JlAiBhb4LpocwEEoqO4fmVrhuBLQkWVpVdDo4pck0-HZSB9JBo',
    price: 5,
  },
  {
    id: 'blossom',
    name: 'Blossom',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/BlossomGun.png',
    price: 900,
  },
  {
    id: 'boneblade',
    name: 'Boneblade',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEjrxwLrplVqppLYvVE49bv3c58HdbL21AR6R_OQApxZnU7uPEWJ-zDs54Sp5Pli3ITqGKIe44bvkho3vSqWoWMOAcITm-YOcEkvCYBBLMcd9zYIvspkEAbf4ttakPm_8hlgXxAFmCOHPTHB_B3yrYZpTJAPTwwtUvlWxmaYN88Puigw3AC3BipQ8jUTyeg',
    price: 8,
  },
  {
    id: 'chroma-boneblade',
    name: 'Chroma Boneblade',
    category: 'knife',
    rarity: 'godly',
    weaponType: 'chroma',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEheR_8ZugjevHK1pS9Htb5FYdFXzTfqueY1Gf-bmO13lcmiFjGW7zlOfXUODP_CHrlLH3_83VLXo2CREHbFCei_NhRh82bihK61txYHNAUaJ4FxndfvhuFpB5PBsNljkwp5pRCgOTRoa5S1pF23ma9YEL0kowCf71UW1YVjTJM_9wsZFo8p6IHZD4J_5zo',
    price: 35,
  },
  {
    id: 'borealis',
    name: 'Borealis',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/2024Borealis.png',
    price: 120,
  },
  {
    id: 'brains-2019',
    name: 'Brains 2019',
    category: 'knife',
    rarity: 'uncommon',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEiVuAqvAODIPuiPoCI-kNZa2BWzlSDgML30aiKdw18DC2MlAazxllayDpJb0b2TrKj60-HiKlVCWb6A47tXHaw0paHmPS6vZdxunIbk_BAM14Y0_EkKgWdVAFtzEWeQUIyTmc2XrCVPWM-WWvCj5-Lnq8REopOmVOlqwJ-FVvYvRbX-QMYq8NQMnp-0gFA',
    price: 45,
  },
  {
    id: 'candleflame',
    name: 'Candleflame',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEign0ZucujuZhy63UcTxUJEiSzHXkW1AR5gezFaALsWVKI_MftpwLcPl_a5qzpt-1l3rr_XF1uQul0geXO6Bhzk-5V28F-bCTo3B3m8i_KM_1a_3_ouPpd_AjKrngUlOK-Bl2SqjkLzEz9_1h3ZZO_8ITaKPI4a0FwZE5SN5lGoi1gyvtxNAe_7kYsxO4E',
    price: 60,
  },
  {
    id: 'candy',
    name: 'Candy',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEgW-HiL9EB6vRqMwSXpwdp5jgB6iottQidKWVektDe_kUbtS1409jPsx-whc-onLetK2_yM6Qe6dvuAA0n38A1couhDIIl6QWYyLR4YrrweFWmjC4JPSBb1BttSoG0H7__aV-pSLUjc8vDeZu3dO5ClOlMi6A8zPXcyUprAH4Y2LgmwVE73FSgtIpEfAYc',
    price: 175,
  },
  {
    id: 'cane-knife',
    name: 'Cane Knife',
    category: 'knife',
    rarity: 'rare',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Cane_knife2018UP.png',
    price: 500,
  },
  {
    id: 'cavern-knife',
    name: 'Cavern Knife',
    category: 'knife',
    rarity: 'legendary',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Cavernknife19UP.png',
    price: 10,
  },
  {
    id: 'celestial',
    name: 'Celestial',
    category: 'knife',
    rarity: 'ancient',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Celestial.png',
    price: 1750,
  },
  {
    id: 'chill',
    name: 'Chill',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEjt4vxiw_JAcyYSg8L4ym6u1-xUvh4z7Eftjvtu1hnne-yogNX1smw5JhXStcoBHMw88c09yX9XtwEmIZBTl5Xu4xvgLpQLBlsuOd2uTFWQi4xQlq4tdCTQDokhrLXP2qYUToH7p5EsCgTiYBUNRD0IdyfKw3Vu7PV7AWyEHOh_HapXAzaZ1RcYgRdtIeU',
    price: 15,
  },
  {
    id: 'clockwork',
    name: 'Clockwork',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEgDOjN2qTOV6zT39FwgmypLQN9pjZR2UstGOKvAm_ViqqoIic_YkCxjL2JYTPQWEGfRWnKwkYQvkgtrbszil8_VD8jCIdMh-IWRIis--lTMfa2vWviuIeuZXasBdhk5zZIFCfoWyL4CS8v-GvXn6Pw2da3682Amr1sOmJwxnjb1yc4f8PNlOgYSOed_Pw8',
    price: 15,
  },
  {
    id: 'constellation',
    name: 'Constellation',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/2024Constellation.png',
    price: 2900,
  },
  {
    id: 'cookieblade',
    name: 'Cookieblade',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEg4iy8_vxUjVCuI-DWlejGqSXrwvVFXXLrFiXUVDD-acNqgoRvcCXtDszpMBUwA06JIaByaXcqEXfMzZLuBbpERA_CUrMKgC62gKs-RR_TkN2ULALRK-6RGtvt24cN_8PI0sA5y2c5_2vM9kSSLqtsXf1fKV1u1Dcz7d8mLChNtw11T7jbXFbis4WcKrs8',
    price: 5,
  },
  {
    id: 'cookiecane',
    name: 'Cookiecane',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEggpJrsLziYe_uIM7_-KgdcPnsI9FwjARHOh_M_-AN7lH57xcVZ0yUa7f_QjOWuZGDHIQjjzD8R0EQ5fhG-QjbIHyUkl2B_ykGJsNtUTNqDXQfL3dYz4qZ6L_5zUYOIMmA-e3dZq-EBlUuWbyXR4iaBldxdraK8vcB2sj0zPE-bTC_mVLztG5p2_rlgR-c',
    price: 20,
  },
  {
    id: 'corrupt',
    name: 'Corrupt',
    category: 'knife',
    rarity: 'unique',
    weaponType: '',
    image: 'https://www.mm2values.com/img/CorruptUp.png',
    price: 800,
  },
  {
    id: 'cotton-candy',
    name: 'Cotton Candy',
    category: 'knife',
    rarity: 'legendary',
    weaponType: '',
    image: 'https://www.mm2values.com/img/CottoncandyUP.png',
    price: 45,
  },
  {
    id: 'darkbringer',
    name: 'Darkbringer',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEiPdBw2AjX2XreTnC4OSaW3gBdLextYPKE_nirYIHR-flZnkZGLVGdJPsvXFQR4nKO4a_NP8WV4amHGYwOAoGHVsdetofwiXtmQXLwg4AN_XTAPfu2assboV2qgOiEUl-p4GAKMNPxELVA_rnFVQkwavCpYyASNEw79VVjrHIgTXuG7662t9XV25basWrk',
    price: 60,
  },
  {
    id: 'darksword',
    name: 'Darksword',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Darksword.png',
    price: 1030,
  },
  {
    id: 'darkshot',
    name: 'Darkshot',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Darkshot.png',
    price: 1050,
  },
  {
    id: 'deathshard',
    name: 'Deathshard',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEhx8DtZtHGR_FWsiDDyYy9IsmyM2ZODUw7k-azMP24u_z4O8S8lAwXA7hpzeaZPKUpIF4s_nDZ943a0QJdrILLuiWo_iQbTsNTypMcBkhzIEtfXKM7Tlw8MxMf4CmiRS-D7UqkpxJKHhWc3BlYD6leOLEW0HRYkPepvjpeqXN1r6Mb5kaghMJNG9EAj3BE',
    price: 15,
  },
  {
    id: 'chroma-deathshard',
    name: 'Chroma Deathshard',
    category: 'knife',
    rarity: 'godly',
    weaponType: 'chroma',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEiAoIO7YideEwoysdd6pX1xZrze28oeSYhLwpwXi2JdP6aByIjBedwuwZBYN6QYbxrEexsfPe9uDe9kgF4gtJ3tMdgcwUEl5yXuRnZQk8SknrsdJ3LaK4ADA6EEeSLCza12Oh9I-mg0_It3o2bTVsra0KMeJGwbq_QnWbxxpMpm7HP4irjdRNlrgiqb-sg',
    price: 45,
  },
  {
    id: 'dungeon',
    name: 'Dungeon',
    category: 'knife',
    rarity: 'rare',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Dungeon19UP.png',
    price: 30,
  },
  {
    id: 'eggblade',
    name: 'Eggblade',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEj1E4BKjUvJ9iSWGIXisinIeKw_sYK6fVtQgHw-QBLSPgAarHqKpaRj-NwiPGuD0uzpL_oQ9JiDjbUAJhct9rJ3z2FTVM8LY_9P8PnFsMOKBygNi6sZxknLmMqGrH1P4LPQQSLNACKXTF_o5yII2-EpsiJLx869Fy7o0wM9ER0WwOjHkbnw3brA3aN1ObA',
    price: 7,
  },
  {
    id: 'elderwood-blade',
    name: 'Elderwood Blade',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEibXbJkWppGGW_uDipgavfXn6XzAquvMPiO74VrHFsxO1wZ2KNgYD4IFFzur_TsE6bFTjaF_g8eP0I_Utff7tY8nX6bSzKeBoKOmSWtbRjTZC8jmR0K2yu20yLEOP7JNW5pCvaogdzrr8UNAW1Mc6D48I9JGEy8c3RQEYHr6i36rMJ6h1Da0tDIqq7ZV8w',
    price: 60,
  },
  {
    id: 'chroma-elderwood-blade',
    name: 'Chroma Elderwood Blade',
    category: 'knife',
    rarity: 'godly',
    weaponType: 'chroma',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEh03RXeMWPbUSKb0msXDeapO9zAYB-BncgPWwH9XobTFnA9uXrXcpwcxr7D3UO1HXkaT-l1WeRHTBFQ-kM3sINqlW5vs9mVhnjv5-23oli4KPLvAlHseAWgT4rgwSWY96lt0IV0bU4bfkxWdwvkqdBKBevbXSJKUo2LXtW8T2VRe8R9n07ZWGnFHE7Nnkc',
    price: 90,
  },
  {
    id: 'elderwood-revolver',
    name: 'Elderwood Revolver',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEhBzUqOcuYxzzzwWCBcSRtThYxnKRfAOwoZiFWA1oTgdGT8tiPbRckd-UVWiLQj9xWGFIZrc0TJ6tuhW3oGPGv-qYvYbFJ5ui24DImgVnpZsK4Q_qIvc0QQqvMDV6DO8GZ7zRtM9hjh0jDQxOEYH99MTwe36MJ93L3J2sl-jEoLD704HnCF4s8kGbr4_aw',
    price: 60,
  },
  {
    id: 'elderwood-scythe',
    name: 'Elderwood Scythe',
    category: 'knife',
    rarity: 'ancient',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEh0F3Y6BnOOUf8mkRiUzp-Zk8Pw_dCt_UR_VgfHzWKUVap86hrU__veedEWH3-gC9UM8OEjC2PxxAE0ByuDClOq1g7vfVEY-GZ5lv7vBsJddN3OFrgrIk63jqFXqqXFeA1JjpiRiZeLPNbAqdX7hSP9wzT_nGIj7-UPzK-96qq7T9L03UQhJJaRS6YVwRU',
    price: 70,
  },
  {
    id: 'eternal',
    name: 'Eternal',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEhOKxN-B2ZpRWhz1QKVW_TBS6rQC7ti48E-qdbGfuQKK9lMtH_9IsArdeQOHGP97Z3DuewNs5j5G87lkIW2FMRHwKe0B-ZX_c-oTF1mlTYQRRDKLbLtarf6IHFnjNIvpZW4Yfny_wa1j4YPEH0_tu1Tfs5ePWx8dY1WdX7lTfxIEr8_H1qMN4Unm5a4yFs',
    price: 10,
  },
  {
    id: 'eternal-2',
    name: 'Eternal 2',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEipda29byq4jf-5x5gCM-Qja-Lugc2tySYWao-l50T9KF2Y-0Mpl1fnnNa1Zw3G6Ksc7D5lScTEQItq_Z7Uh9T4YVjY0XFal6MITRgq1FkkkOQhg3AfiOYFUAiTfH46PKU911sEwlAZUTvqJRVVmmhPbIzNWmQOvqeOxoRsVetQfn49_YkgvpDk_VShbO8',
    price: 10,
  },
  {
    id: 'eternal-3',
    name: 'Eternal 3',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEiI0WvykzdrraQ3rA4pC_o7fgV-Sg4aSmKptM80NfTusvvacmOcbP8jaQDeXvHMwWFBY6fkG1nus-qTqUwAM88Z61cMeD9aCgQ_YQGyrZXqtWi3Tyc7nGA9GtLCtKgOt6MAhqpq9pYLa6y4V3o4OEh8Ay8f06erM7MZTZlaQ5PwyoFIWwTaXWCF5wUDH2Q',
    price: 10,
  },
  {
    id: 'eternal-4',
    name: 'Eternal 4',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEiFBu46reT2rdU_s6S1svInYMsZHkGctFjolPdo5qZRqdAKsBFhhLULRsjZ4fvFTZbTXmVK9S3ChgaQQHqaIC3OG8kaulzrxjO1536oTE8n8uTNahu2jcYNrWxguxf68JfIsddChiKfcUonwp0T25hcNRn9Zzpzf-b-QHb9ylQHG62oPbaiS7Y00MFI0I',
    price: 10,
  },
  {
    id: 'eternalcane',
    name: 'Eternalcane',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://blogger.googleusercontent.com/img/a/AVvXsEjbjhlM6w9HJRNovGQglpTA7w1JhJ2giXdVPLHoK8JrSMxXVBGKaoaBKAtlT9OZwNZSzDveYxX-yif_6v0dSSlQGAdwad41zKaXuCX2LqVFa7TW_PW-G2pliDw988kdxwbWcVFgxGgFdNciW7p4d5iFN-vEX4H3D2Bj7C1VfwCbyZTuv0glFYKWx1CsC94',
    price: 20,
  },
  {
    id: 'evergreen',
    name: 'Evergreen',
    category: 'knife',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Evergreen.png',
    price: 3000,
  },
  {
    id: 'evergun',
    name: 'Evergun',
    category: 'gun',
    rarity: 'godly',
    weaponType: '',
    image: 'https://www.mm2values.com/img/Evergun.png',
    price: 3900,
  },
];

let stockData = {};
let currentFilter = 'all';

// ========= –†–ê–°–ß–Å–¢ –¶–ï–ù–´ +40% =========
function calcMarkup(base) {
  const p = base * 1.40;
  if (p < 10)   return Math.ceil(p);
  if (p < 100)  return Math.ceil(p / 5) * 5;
  if (p < 1000) {
    const last = Math.floor(p) % 10;
    const b    = Math.floor(p / 10) * 10;
    if (last === 0)    return b;
    else if (last <= 5) return b + 5;
    else               return b + 10;
  }
  return Math.ceil(p / 10) * 10;
}

// ========= LOGIN =========
function doLogin() {
  const val = document.getElementById('password-input').value;
  if (val === ADMIN_PASSWORD) {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('main-panel').style.display  = 'block';
    loadFromJsonBin();
  } else {
    document.getElementById('login-error').style.display = 'block';
    document.getElementById('password-input').value = '';
  }
}

function doLogout() {
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('main-panel').style.display   = 'none';
  document.getElementById('password-input').value = '';
}

// ========= JSONBIN =========
async function loadFromJsonBin() {
  showStatus('–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
  try {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
      headers: { 'X-Master-Key': JSONBIN_API_KEY }
    });
    if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ ' + res.status);
    const data = await res.json();
    stockData = data.record || {};
    showStatus('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã ‚úì', 'success');
  } catch(e) {
    showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e.message, 'error');
  }
  PRODUCTS.forEach(p => {
    if (!stockData[p.id]) {
      stockData[p.id] = { inStock: true, price: p.price, oldPrice: null, popular: false };
    }
    if (stockData[p.id].popular === undefined) stockData[p.id].popular = false;
  });
  renderProducts();
  updateStats();
}

async function saveToJsonBin() {
  const btn = document.getElementById('save-btn');
  btn.disabled = true;
  showStatus('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...', 'loading');
  try {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_API_KEY },
      body: JSON.stringify(stockData)
    });
    if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ ' + res.status);
    showStatus('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì –ú–∞–≥–∞–∑–∏–Ω –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
  } catch(e) {
    showStatus('–û—à–∏–±–∫–∞: ' + e.message, 'error');
  }
  btn.disabled = false;
}

// ========= UI =========
function showStatus(msg, type) {
  const el = document.getElementById('status-msg');
  el.textContent = msg;
  el.className = 'status-msg show ' + type;
  if (type === 'success') setTimeout(() => el.classList.remove('show'), 3500);
}

function setFilter(f) {
  currentFilter = f;
  ['all','in','out'].forEach(x =>
    document.getElementById('filter-' + x).classList.toggle('active', x === f)
  );
  renderProducts();
}

function bulkSet(val) {
  const search = document.getElementById('admin-search').value.toLowerCase();
  PRODUCTS.forEach(p => {
    if (!search || p.name.toLowerCase().includes(search)) {
      if (stockData[p.id]) stockData[p.id].inStock = val;
    }
  });
  renderProducts();
  updateStats();
}

function toggle(id) {
  if (!stockData[id]) return;
  stockData[id].inStock = !stockData[id].inStock;
  updateStats();
  const card = document.querySelector(`[data-id="${id}"]`);
  if (card) {
    const inStock = stockData[id].inStock;
    card.classList.toggle('out', !inStock);
    const inp = card.querySelector('input[type=checkbox]');
    if (inp) inp.checked = inStock;
    const lbl = card.querySelector('.toggle-label');
    if (lbl) { lbl.textContent = inStock ? '–í –ù–ê–õ–ò–ß–ò–ò' : '–ù–ï–¢'; lbl.className = 'toggle-label ' + (inStock ? 'in' : 'out'); }
  }
}

function togglePopular(id) {
  if (!stockData[id]) return;
  stockData[id].popular = !stockData[id].popular;
  const card = document.querySelector(`[data-id="${id}"]`);
  if (card) {
    const pop = stockData[id].popular;
    const btn = card.querySelector('.popular-btn');
    if (btn) {
      btn.textContent = pop ? '‚≠ê –ü–û–ü–£–õ–Ø–†–ù–û–ï' : '‚òÜ –Ω–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ';
      btn.classList.toggle('popular-on', pop);
    }
  }
}

function updatePrice(id, field, value) {
  if (!stockData[id]) return;
  if (field === 'oldPrice' && (value === '' || value === '0')) {
    stockData[id].oldPrice = null;
  } else {
    const num = parseFloat(value);
    if (!isNaN(num) && num > 0) stockData[id][field] = num;
  }
  refreshPreview(id);
}

function refreshPreview(id) {
  const el = document.querySelector(`[data-id="${id}"] .price-preview`);
  if (!el || !stockData[id]) return;
  el.innerHTML = buildPreviewHTML(id);
}

function buildPreviewHTML(id) {
  const d        = stockData[id];
  const price    = d.price    || 0;
  const oldPrice = d.oldPrice || null;
  const hasDisc  = oldPrice && oldPrice > 0;
  const displayPrice = calcMarkup(price);

  if (hasDisc) {
    const disc = Math.round((1 - displayPrice / oldPrice) * 100);
    return `<span class="dim">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç: </span>`
         + `<span class="pv">${displayPrice}</span> `
         + `<span class="po">${oldPrice}</span> `
         + `<span class="pd">‚àí${disc}%</span>`;
  } else {
    return `<span class="dim">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç: </span>`
         + `<span class="pv">${displayPrice}</span> `
         + `<span class="dim">(+40% –æ—Ç ${price})</span>`;
  }
}

function updateStats() {
  const total   = PRODUCTS.length;
  const inCount = PRODUCTS.filter(p => stockData[p.id] && stockData[p.id].inStock).length;
  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-in').textContent    = inCount;
  document.getElementById('stat-out').textContent   = total - inCount;
}

function renderProducts() {
  const search = document.getElementById('admin-search').value.toLowerCase();
  const grid   = document.getElementById('admin-product-grid');

  const filtered = PRODUCTS.filter(p => {
    const match    = p.name.toLowerCase().includes(search);
    const inStock  = stockData[p.id] && stockData[p.id].inStock;
    const passFilter =
      currentFilter === 'all' ||
      (currentFilter === 'in'  &&  inStock) ||
      (currentFilter === 'out' && !inStock);
    return match && passFilter;
  });

  if (filtered.length === 0) {
    grid.innerHTML = `<div class="empty-state"><div>üîç</div>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
    return;
  }

  grid.innerHTML = filtered.map(p => {
    const d        = stockData[p.id] || { inStock: true, price: p.price, oldPrice: null };
    const inStock  = d.inStock;
    const price    = d.price    ?? p.price;
    const oldPrice = d.oldPrice || null;
    const hasDisc  = oldPrice && oldPrice > 0;
    const displayPrice = calcMarkup(price);
    const discPct  = hasDisc ? Math.round((1 - displayPrice / oldPrice) * 100) : 0;
    const popular  = d.popular || false;
    const previewHTML = buildPreviewHTML(p.id);

    return `
      <div class="product-card ${inStock ? '' : 'out'}" data-id="${p.id}">

        <div class="product-card-top">
          <img class="product-img" src="${p.image}" alt="${p.name}"
               loading="lazy" onerror="this.style.opacity=0.2">
          <div class="product-info">
            <div class="product-name-txt">${p.name}</div>
            <div class="product-meta">
              <span class="badge badge-rarity-${p.rarity}">${p.rarity.toUpperCase()}</span>
              <span class="badge badge-cat">${p.category.toUpperCase()}</span>
              ${p.weaponType === 'chroma' ? '<span class="badge badge-chroma">CHROMA</span>' : ''}
              ${hasDisc ? `<span class="badge badge-disc">‚àí${discPct}%</span>` : ''}
            </div>
          </div>
          <div class="toggle-wrap">
            <label class="toggle">
              <input type="checkbox" ${inStock ? 'checked' : ''} onchange="toggle('${p.id}')">
              <span class="slider"></span>
            </label>
            <span class="toggle-label ${inStock ? 'in' : 'out'}">${inStock ? '–í –ù–ê–õ–ò–ß–ò–ò' : '–ù–ï–¢'}</span>
          </div>
        </div>

        <button class="popular-btn ${popular ? 'popular-on' : ''}" onclick="togglePopular('${p.id}')">
          ${popular ? '‚≠ê –ü–û–ü–£–õ–Ø–†–ù–û–ï' : '‚òÜ –Ω–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ'}
        </button>

        <div class="price-editor">
          <div class="price-fields">
            <div class="price-field">
              <label>–¶–ï–ù–ê (–±–∞–∑–∞)</label>
              <input class="price-input" type="number" inputmode="numeric" min="1"
                value="${price}"
                onchange="updatePrice('${p.id}', 'price', this.value)">
            </div>
            <div class="price-field">
              <label>–°–¢–ê–†–ê–Ø –¶–ï–ù–ê (—Å–∫–∏–¥–∫–∞)</label>
              <input class="price-input" type="number" inputmode="numeric" min="0"
                value="${oldPrice ?? ''}" placeholder="–Ω–µ—Ç"
                onchange="updatePrice('${p.id}', 'oldPrice', this.value)">
            </div>
          </div>
          <div class="price-preview">${previewHTML}</div>
        </div>

      </div>
    `;
  }).join('');
}

setFilter('all');
</script>
</body>
</html>
